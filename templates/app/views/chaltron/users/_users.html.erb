<div id='users'>
  <div class='row'>
    <div class='col-md-3'>
      <%# Provider filters %>
      <% if ldap_enabled? %>
      <div class='card mb-3'>
        <div class='card-header'>
          <%= t('.provider_filter') %>
        </div>
        <div class='list-group list-group-flush'>
          <%= display_side_filter_link(request.params.merge(provider: 'ldap', page: nil),
                                      filter_provider == 'ldap', t('.ldap'), @count_users_ldap) %>
          <%= display_side_filter_link(request.params.merge(provider: 'local', page: nil),
                                      filter_provider == 'local', t('.local'), @count_users_local) %>
        </div>
      </div>
      <% end %>
      <%# Inactivity filter %>
      <div class='card mb-3'>
        <div class='card-header'>
          <%= t('.inactivity_filter') %>
        </div>
        <div class='list-group list-group-flush'>
          <%= display_side_filter_link(request.params.merge(activity: 'no_login', page: nil),
                                      filter_activity == 'no_login', t('.no_login'), @count_users_inactive) %>
        </div>
      </div>
      <%# Reset filters %>
      <%= link_to t('.reset_filters'), request.params.merge(provider: nil, activity: nil),
                                                    class: 'btn btn-primary w-100 mb-3', remote: true %>
    </div>
    <div class='col-md-9'>
      <div class='d-flex'>
        <%# Search form %>
        <div class='flex-grow-1'>
          <%= form_tag chaltron_users_path, method: 'get', class: 'mb-3', remote: true do %>
            <%= hidden_field_tag :direction, sort_direction %>
            <%= hidden_field_tag :sort, sort_column %>
            <div class='input-group'>
              <%= text_field_tag :search, params[:search],
                                  class: 'form-control', placeholder: t('.search')%>
              <button class='btn btn-primary' type='submit'>Cerca</button>
            </div>
          <% end %>
        </div>
        <%# Users per page %>
        <div class='ms-3'>
          <div id='sort-per-page' class='dropdown text-nowrap mb-3'>
            <%= link_to t('.sort_per_page', count: sort_per_page), '#',
                        data: { 'bs-toggle': 'dropdown' }, aria: { expanded: false },
                        class: 'btn btn-primary dropdown-toggle' %>
            <ul class='dropdown-menu' aria-labelledby='per-page'>
              <% %w[10 20 50 100].each do |count| %>
                <li>
                <%= link_to t('.sort_per_page', count: count),
                            request.params.merge(per_page: count, page: nil),
                            class: class_names('dropdown-item', { active: sort_per_page == count }),
                            remote: true %>
                </li>
              <% end %>
            </ul>
          </div>
        </div>
        <%# Sort columns %>
        <div class="ms-3">
          <div id='sort' class='btn-group mb-3 float-end' role='group'>
            <div class='btn-group' role='group'>
              <button id='sort-column' type='button' class='btn btn-primary dropdown-toggle' data-bs-toggle='dropdown' aria-expanded='false'>
                <%= t('.sorted_by') %> <%= Chaltron::User.human_attribute_name(sort_column).downcase %>
              </button>
              <ul class='dropdown-menu' aria-labelledby='sort-column'>
                <li>
                  <%= link_to Chaltron::User.human_attribute_name(:username),
                              request.params.merge(sort: :username, page: nil),
                              class: class_names('dropdown-item', { active: sort_column == 'username' }),
                              remote: true %>
                </li>
                <li>
                  <%= link_to Chaltron::User.human_attribute_name(:email),
                              request.params.merge(sort: :email, page: nil),
                              class: class_names('dropdown-item', { active: sort_column == 'email' }),
                              remote: true %>
                </li>
                <li>
                  <%= link_to Chaltron::User.human_attribute_name(:created_at),
                              request.params.merge(sort: :created_at, page: nil),
                              class: class_names('dropdown-item', { active: sort_column == 'created_at' }),
                              remote: true %>
                </li>
              </ul>
            </div>
            <%= link_to(request.params.merge(direction: (sort_direction == 'asc' ? 'desc' : 'asc'), page: nil),
                        remote: true, class: 'btn btn-outline-primary') do %>
              <%= icon :fas, sort_direction == 'desc' ? 'sort-alpha-up' : 'sort-alpha-down' %>
            <% end %>
          </div>
        </div>
      </div>

      <% for user in users %>
        <%= render partial: 'user', locals: { user: user } %>
      <% end %>
      <div class='mt-3'>
        <%== pagy_info(pagy) %>
        <div class='float-end'>
          <%== pagy_bootstrap_nav(pagy, link_extra: "data-remote='true'") %>
        </div>
      </div>
    </div>
  </div>
</div>