<div class='row'>
  <div class='col-md-3'>
    <h4><%= t('.filters')%></h4>
    <%= simple_form_for @filter, as: :filter, url: chaltron_logs_path, method: 'get' do |f| %>
      <%= f.hidden_field(:search) %>
      <%= hidden_field_tag 'sort_direction', sort_direction %>
      <%= hidden_field_tag 'sort_column', sort_column %>
      <%= hidden_field_tag 'per_page', per_page %>
      <% labels = @severities.to_a.map do |x|
        "#{t("chaltron.logs.severity.#{x.first}")} (#{number_with_delimiter(x.last, delimiter: '.')})"
        end %>
      <%= f.input :severities, collection: labels.zip(@severities.keys).to_a,
                               as: :check_boxes, wrapper: :vertical_collection_inline, include_hidden: false %>
      <% labels = @categories.to_a.map do |x|
        "#{t("chaltron.logs.category.#{x.first}")} (#{number_with_delimiter(x.last, delimiter: '.')})"
        end %>
      <%= f.input :categories, collection: labels.zip(@categories.keys).to_a,
                               as: :check_boxes, wrapper: :vertical_collection_inline, include_hidden: false %>
      <%= f.submit t('.submit_filters'), class: 'btn btn-primary w-100' %>
    <% end %>
    <hr>
    <%# Reset filters %>
    <%= link_to t('.reset_filters'),
                chaltron_logs_path(
                  request.params.deep_merge(
                    filter: { severities: [], categories: [] }, page: nil
                  )
                ),
                class: 'btn btn-primary w-100 mb-3' %>
  </div>
  <div class='col-md-9'>
    <div class='d-flex'>
      <%# Search form %>
      <div class='flex-grow-1'>
        <%= form_tag chaltron_logs_path, method: 'get' do %>
          <%= hidden_field_tag 'sort_direction', sort_direction %>
          <%= hidden_field_tag 'sort_column', sort_column %>
          <%= hidden_field_tag 'per_page', per_page %>
          <% @filter.categories&.each do |i| %>
            <%= hidden_field_tag('filter[categories][]', i, multiple: true) %>
          <% end %>
          <% @filter.severities&.each do |i| %>
            <%= hidden_field_tag('filter[severities][]', i, multiple: true) %>
          <% end %>
          <div class='input-group mb-3'>
            <%= text_field_tag 'filter[search]', @filter.search,
                               class: 'form-control', placeholder: t('.search_placeholder'), size: 50 %>
            <span class='input-group-text'>
              <%= link_to icon(:fas, 'trash-alt'),
                          chaltron_logs_path(
                            request.params.deep_merge(filter: { search: '' }, page: nil)
                          ),
                          title: t('.reset_search'),
                          data: {
                            controller: 'chaltron--tooltip',
                            bs_toggle: 'tooltip',
                            bs_trigger: 'hover'
                          } %>
            </span>
            <button class='btn btn-primary' type='submit'><%= t('.search') %></button>
          </div>
        <% end %>
      </div>
      <%# Per page %>
      <div class='ms-3'>
        <div id='sort-per-page' class='dropdown text-nowrap mb-3 float-end'>
          <%= link_to t('.per_page', count: per_page), '#',
                      data: { 'bs-toggle': 'dropdown' }, aria: { expanded: false },
                      class: 'btn btn-primary dropdown-toggle' %>
          <ul class='dropdown-menu' aria-labelledby='per-page'>
            <% [10, 20, 50, 100].each do |count| %>
              <li>
              <%= link_to t('.per_page', count: count),
                          chaltron_logs_path(
                            request.params.merge(per_page: count, page: nil)
                          ),
                          class: class_names('dropdown-item', { active: per_page == count }) %>
              </li>
            <% end %>
          </ul>
        </div>
      </div>
      <%# Sort columns %>
      <div class='ms-3'>
        <div id='sort' class='btn-group mb-3 float-end' role='group'>
          <div class='btn-group' role='group'>
            <button id='sort-column' type='button' class='btn btn-primary dropdown-toggle' data-bs-toggle='dropdown' aria-expanded='false'>
              <%= t('.sorted_by') %> <%= Chaltron::Log.human_attribute_name(sort_column).downcase %>
            </button>
            <ul class='dropdown-menu' aria-labelledby='sort-column'>
              <% %w[created_at message].each do |field| %>
              <li>
                <%= link_to chaltron_logs_path(
                              request.params.merge(sort_column: field, page: nil)
                            ),
                            class: class_names('dropdown-item', { active: sort_column == field }) do %>
                    <%= t('.sorted_by') %> <%= Chaltron::Log.human_attribute_name(field).downcase %>
                <% end %>
              </li>
              <% end %>
            </ul>
          </div>
          <%= link_to(chaltron_logs_path(
                        request.params.merge(sort_direction: (sort_direction == 'asc' ? 'desc' : 'asc'),
                                             page: nil)), class: 'btn btn-outline-primary') do %>
            <%= icon :fas, sort_direction == 'desc' ? 'sort-alpha-up' : 'sort-alpha-down' %>
          <% end %>
        </div>
      </div>
    </div>
    <div class='list-group'>
      <%= render partial: 'log', collection: @logs, locals: { filter: @filter } %>
    </div>
    <div class='mt-3'>
      <%== pagy_info(@pagy) %>
      <div class='float-end'>
        <%== pagy_bootstrap_nav(@pagy) %>
      </div>
    </div>
  </div>
</div>
