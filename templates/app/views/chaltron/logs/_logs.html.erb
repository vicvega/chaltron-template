<div id='logs'>
  <div class='row'>
    <div class='col-md-3'>
      <%# Severity filters %>
      <div class='card mb-3'>
        <div class='card-header'>
          <%= t('.severity_filter') %>
        </div>
        <div class='list-group list-group-flush'>
          <% @logs_group_severity.each do |k, v| %>
            <%= display_side_filter_link(request.params.merge(severity: k, page: nil), filter_severity == k,
                                         t("chaltron.logs.severity.#{k}"), v) %>
          <% end %>
        </div>
      </div>
      <%# Category filters %>
      <div class='card mb-3'>
        <div class='card-header'>
          <%= t('.category_filter') %>
        </div>
        <div class='list-group list-group-flush'>
          <% @logs_group_category.each do |k, v| %>
            <%= display_side_filter_link(request.params.merge(category: k, page: nil), filter_category == k,
                                         t("chaltron.logs.category.#{k}"), v) %>
          <% end %>
        </div>
      </div>
      <%# Reset filters %>
      <%= link_to t('.reset_filters'), request.params.merge(category: nil, severity: nil),
                  class: 'btn btn-primary w-100 mb-3', remote: true %>
    </div>
    <div class='col-md-9'>

      <div class='d-flex'>
        <%# Search form %>
        <div class='flex-grow-1'>
          <%= form_tag chaltron_logs_path, method: 'get', remote: true do %>
            <%= hidden_field_tag :direction, params[:direction] %>
            <%= hidden_field_tag :sort, params[:sort] %>
            <div class='input-group mb-3'>
              <%= text_field_tag :search, params[:search],
                                 class: 'form-control', placeholder: t('.search'), size: 50 %>
              <button class='btn btn-primary' type='submit'>Cerca</button>
            </div>
          <% end %>
        </div>
        <%# Logs per page %>
        <div class='ms-3'>
          <div id='sort-per-page' class='dropdown text-nowrap mb-3 float-end'>
            <%= link_to t('.sort_per_page', count: sort_per_page), '#',
                        data: { 'bs-toggle': 'dropdown' }, aria: { expanded: false },
                        class: 'btn btn-primary dropdown-toggle' %>
            <ul class='dropdown-menu' aria-labelledby='per-page'>
              <% [10, 20, 50, 100].each do |count| %>
                <li>
                <%= link_to t('.sort_per_page', count: count),
                            request.params.merge(per_page: count, page: nil),
                            class: class_names('dropdown-item', { active: sort_per_page == count }),
                            remote: true %>
                </li>
              <% end %>
            </ul>
          </div>
        </div>
        <%# Sort columns %>
        <div class="ms-3">
          <div id='sort' class='btn-group mb-3 float-end' role='group'>
            <div class='btn-group' role='group'>
              <button id='sort-column' type='button' class='btn btn-primary dropdown-toggle' data-bs-toggle='dropdown' aria-expanded='false'>
                <%= t('.sorted_by') %> <%= Chaltron::Log.human_attribute_name(sort_column).downcase %>
              </button>
              <ul class='dropdown-menu' aria-labelledby='sort-column'>
                <% %w[created_at message].each do |field| %>
                <li>
                  <%= link_to request.params.merge(sort: field, page: nil),
                              class: class_names('dropdown-item', { active: sort_column == field }),
                              remote: true do %>
                      <%= t('.sorted_by') %> <%= Chaltron::Log.human_attribute_name(field).downcase %>
                  <% end %>
                </li>
                <% end %>
              </ul>
            </div>
            <%= link_to(request.params.merge(direction: (sort_direction == 'asc' ? 'desc' : 'asc'), page: nil),
                        remote: true, class: 'btn btn-outline-primary') do %>
              <%= icon :fas, sort_direction == 'desc' ? 'sort-alpha-up' : 'sort-alpha-down' %>
            <% end %>
          </div>
        </div>
      </div>

      <%= render partial: 'log', collection: logs %>

      <div class='mt-3'>
        <%== pagy_info(pagy) %>
        <div class='float-end'>
          <%== pagy_bootstrap_nav(pagy, link_extra: "data-remote='true'") %>
        </div>
      </div>
    </div>
  </div>
</div>
